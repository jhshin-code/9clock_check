<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì¼ ë§ì”€ ì¶œì„ë¶€</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f0f2f5; padding: 20px; text-align: center; color: #333; }
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container { max-width: 450px; margin: 0 auto; background: white; padding: 30px 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        
        h2 { margin: 0 0 20px 0; color: #2c3e50; font-size: 24px; }
        
        #live-clock { font-size: 28px; font-weight: 800; color: #333; margin-bottom: 5px; letter-spacing: 1px; font-variant-numeric: tabular-nums; }
        
        /* ì…ë ¥ í•„ë“œ */
        select { width: 100%; padding: 14px; margin: 8px 0; font-size: 16px; border-radius: 12px; border: 1px solid #ddd; background-color: #fafafa; outline: none; transition: 0.2s; }
        select:focus { border-color: #007bff; background-color: white; }

        /* ë²„íŠ¼ */
        .main-btn { width: 100%; padding: 16px; font-size: 18px; border-radius: 12px; border: none; cursor: pointer; font-weight: bold; color: white; transition: 0.2s; margin-top: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #attend-btn { background: linear-gradient(135deg, #007bff, #0056b3); }
        #attend-btn:active { transform: scale(0.98); }
        #attend-btn:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; }
        
        /* ë§í¬í˜• ë²„íŠ¼ (ì‚¬ìœ ì œì¶œ) */
        .link-btn { background: none; border: none; color: #6c757d; text-decoration: underline; font-size: 14px; margin-top: 15px; cursor: pointer; padding: 10px; }

        /* í†µê³„ ë²„íŠ¼ */
        #stats-btn { background-color: #17a2b8; width: 100%; padding: 12px; border:none; border-radius: 10px; color: white; font-weight: bold; margin-top: 30px; cursor: pointer; }

        /* ìƒíƒœ ë©”ì‹œì§€ */
        .status-msg { margin: 10px 0 20px 0; font-size: 14px; font-weight: bold; padding: 8px; border-radius: 8px; display: inline-block; width: 100%; box-sizing: border-box;}
        .gps-status { font-size: 12px; color: #888; margin-bottom: 15px; }
        
        .ok-msg { background-color: #d4edda; color: #155724; }
        .no-msg { background-color: #f8d7da; color: #721c24; }
        .test-msg { background-color: #fff3cd; color: #856404; }
        .gps-ok { color: #28a745; font-weight: bold; }
        .gps-no { color: #dc3545; font-weight: bold; }

        /* ëª¨ë‹¬ (íŒì—…) */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(3px); }
        .modal-content { background-color: white; margin: 10% auto; padding: 25px; width: 90%; max-width: 400px; border-radius: 15px; position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.3); animation: slideUp 0.3s; max-height: 85vh; overflow-y: auto; }
        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }
        
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #aaa; }
        
        /* ëŒ€ì‹œë³´ë“œ í…Œì´ë¸” */
        .log-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; text-align: center; }
        .log-table th { background-color: #f8f9fa; padding: 8px; border-bottom: 2px solid #ddd; color: #555; }
        .log-table td { padding: 8px; border-bottom: 1px solid #eee; color: #333; }
        .log-table tr:last-child td { border-bottom: none; }
        
        /* ë°°ì§€ ìŠ¤íƒ€ì¼ */
        .badge { padding: 3px 6px; border-radius: 4px; font-size: 11px; color: white; }
        .bg-ok { background-color: #28a745; }   /* ì •ìƒ: ì´ˆë¡ */
        .bg-warn { background-color: #ff9800; } /* ì§€ê°: ì£¼í™© */
        .bg-no { background-color: #ffc107; color: #333; } /* ê¸°íƒ€: ë…¸ë‘ */
        
        /* PC ë¡œê·¸ì¸ */
        #pc-login-screen { display: none; max-width: 400px; margin: 50px auto; background: white; padding: 40px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<div id="pc-login-screen">
    <h2>ğŸ’» PC ê´€ë¦¬ì ì ‘ì†</h2>
    <p style="color:#666; font-size:14px; margin-bottom:20px;">PC ì ‘ì†ì€ ê´€ë¦¬ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
    <input type="password" id="pc-access-code" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
    <button class="main-btn" style="background:#28a745;" onclick="checkPcLogin()">ì ‘ì†í•˜ê¸°</button>
</div>

<div id="main-app" class="container" style="display:none;">
    <h2>â›ª ì£¼ì¼ ë§ì”€ ì¶œì„ë¶€</h2>
    
    <div id="live-clock">00:00:00</div>
    <div id="time-msg" class="status-msg no-msg">ì‹œê°„ í™•ì¸ ì¤‘...</div>
    <div id="gps-msg" class="gps-status">ìœ„ì¹˜ í™•ì¸ ì¤‘...</div>

    <div style="text-align: left; margin-top: 20px;">
        <label style="font-size:13px; color:#666; margin-left:5px;">ë¶€ì„œ</label>
        <select id="dept-select" onchange="loadNames()"><option value="">ë¶€ì„œ ì„ íƒ</option></select>
        
        <label style="font-size:13px; color:#666; margin-left:5px;">ì´ë¦„</label>
        <select id="name-select" disabled><option value="">ë¨¼ì € ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option></select>
    </div>

    <button id="attend-btn" class="main-btn" onclick="handleAttendance('attend')" disabled>ì¶œì„ì²´í¬ í•˜ê¸°</button>

    <button class="link-btn" onclick="openExcuseModal()">í˜¹ì‹œ ëª» ì˜¤ì…¨ë‚˜ìš”? ì‚¬ìœ  ì œì¶œí•˜ê¸°</button>

    <button id="stats-btn" onclick="openStats()">ğŸ“Š ì‹¤ì‹œê°„ í˜„í™© ë° ëª…ë‹¨ ë³´ê¸°</button>
</div>

<div id="excuseModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('excuseModal')">&times;</span>
        <h3>ğŸ“ ì‚¬ìœ  ì œì¶œ</h3>
        <p style="font-size:14px; color:#666;">ë¶€ë“ì´í•œ ì‚¬ì •ìœ¼ë¡œ ì°¸ì„í•˜ì§€ ëª»í•  ê²½ìš°<br>ì‚¬ìœ ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
        
        <select id="excuse-select-popup">
            <option value="">ì‚¬ìœ ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ì¶œê·¼">ì¶œê·¼</option>
            <option value="ì…ì›">ì…ì›</option>
            <option value="ê²½ì¡°ì‚¬">ê²½ì¡°ì‚¬</option>
            <option value="ì „ë„">ì „ë„</option>
        </select>
        <button class="main-btn" style="background-color:#6c757d; margin-top:10px;" onclick="handleAttendance('excuse')">ì œì¶œí•˜ê¸°</button>
    </div>
</div>

<div id="statsModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('statsModal')">&times;</span>
        
        <h3>ğŸ“Š ë¶€ì„œë³„ ì¶œì„ë¥ </h3>
        <canvas id="myChart" style="margin-bottom:20px;"></canvas>
        
        <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">
        
        <h3>ğŸ“‹ ì˜¤ëŠ˜ ì¶œì„ ëª…ë‹¨ </h3>
        <div style="max-height: 200px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #eee; border-radius: 8px;">
            <table class="log-table">
                <thead><tr><th>ì‹œê°„</th><th>ì´ë¦„</th><th>ë¶€ì„œ</th><th>ìƒíƒœ</th></tr></thead>
                <tbody id="today-log-list"><tr><td colspan="4">ë¡œë”© ì¤‘...</td></tr></tbody>
            </table>
        </div>

        <hr style="border:0; border-top:1px solid #eee; margin: 20px 0;">

        <h3>ğŸ† ê°œì¸ ì¶œì„ ìˆœìœ„ (í‰ê· ) </h3>
        <div id="rank-list" style="text-align: left; background: #f9f9f9; padding: 15px; border-radius: 8px; font-size: 14px; max-height: 250px; overflow-y: auto;">
            ë¡œë”© ì¤‘...
        </div>
    </div>
</div>

<script>
    // ================= [ì„¤ì • ì˜ì—­] =================
    // â˜… ì£¼ì˜: ì•„ë˜ URLì„ ìƒˆë¡œ ë°°í¬í•œ ì›¹ì•± URLë¡œ ê¼­ ë³€ê²½í•´ì£¼ì„¸ìš”!
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxoCZJ8syGUfZcGCRwsV-0SyAI1sJzzXBUrYWsQ1vXL2Tbs6j2YZyKnSuu8UQnuOvVO/exec"; 
    
    // êµíšŒ ì¢Œí‘œ ë° ì„¤ì •
    const TARGET_LAT = 37.192984; 
    const TARGET_LON = 127.059825; 
    const ALLOWED_RADIUS = 300; 
    const PC_ACCESS_PASSWORD = "1324"; 
    // ===============================================

    let membersData = [];
    let isLocationValid = false; 
    let isTimeValid = false; 
    let isAdminMode = false;
    let myChart = null;

    // ì´ˆê¸° ë¡œë“œ
    window.onload = function() {
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (isMobile) {
            initApp();
        } else {
            document.getElementById('pc-login-screen').style.display = 'block';
            document.getElementById("pc-access-code").addEventListener("keyup", function(e) {
                if (e.key === "Enter") checkPcLogin();
            });
        }
    };

    function checkPcLogin() {
        if (document.getElementById('pc-access-code').value === PC_ACCESS_PASSWORD) {
            document.getElementById('pc-login-screen').style.display = 'none';
            isAdminMode = true;
            initApp();
        } else { alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."); }
    }

    function initApp() {
        document.getElementById('main-app').style.display = 'block';
        fetchMembers();
        setInterval(updateClockAndStatus, 1000);
        updateClockAndStatus(); 
        
        if (isAdminMode) {
            isLocationValid = true;
            document.getElementById('gps-msg').innerHTML = `<span class="gps-ok">ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ (ìœ„ì¹˜ PASS)</span>`;
            checkButtons();
        } else {
            checkLocation();
        }
    }

    // ì‹œê°„ ì²´í¬
    function updateClockAndStatus() {
        const now = new Date();
        const day = now.getDay(); 
        document.getElementById('live-clock').innerText = now.toLocaleTimeString('ko-KR', { hour12: false });

        const isSunday = (day === 0); 
        const currentMin = now.getHours() * 60 + now.getMinutes();
        const startMin = 8 * 60 + 0; 
        const endMin = 10 * 60 + 0;    
        const msgBox = document.getElementById('time-msg');

        if (isAdminMode) {
            isTimeValid = true;
            msgBox.innerHTML = "ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ (ì‹œê°„ ì œí•œ ì—†ìŒ)";
            msgBox.className = "status-msg test-msg";
        } else if (isSunday && currentMin >= startMin && currentMin < endMin) {
            isTimeValid = true;
            msgBox.innerHTML = "âœ… ì¶œì„ ì²´í¬ ê°€ëŠ¥ ì‹œê°„ì…ë‹ˆë‹¤";
            msgBox.className = "status-msg ok-msg";
        } else {
            isTimeValid = false;
            msgBox.innerHTML = !isSunday ? "â›” ì˜¤ëŠ˜ì€ ì£¼ì¼ì´ ì•„ë‹™ë‹ˆë‹¤" : "â›” ì¶œì„ ê°€ëŠ¥ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤";
            msgBox.className = "status-msg no-msg";
        }
        checkButtons(); 
    }

    // [ìˆ˜ì •ë¨] ìœ„ì¹˜ ì²´í¬ í•¨ìˆ˜ (ì‹¤íŒ¨í•´ë„ ë²„íŠ¼ í™œì„±í™”ë¥¼ ìœ„í•´ ê³„ì† ì§„í–‰)
    function checkLocation() {
        const gpsMsg = document.getElementById('gps-msg');
        
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition((position) => {
                const dist = getDistanceFromLatLonInMeters(position.coords.latitude, position.coords.longitude, TARGET_LAT, TARGET_LON);
                
                if (dist <= ALLOWED_RADIUS) {
                    isLocationValid = true;
                    gpsMsg.innerHTML = `<span class="gps-ok">ğŸ“ ìœ„ì¹˜ ì¸ì¦ ì™„ë£Œ (${Math.round(dist)}m)</span>`;
                } else {
                    isLocationValid = false;
                    gpsMsg.innerHTML = `<span class="gps-no">âš ï¸ ê±°ë¦¬ ë²—ì–´ë‚¨ (${Math.round(dist)}m) - ìˆ˜ë™ ì²´í¬ ê°€ëŠ¥</span>`;
                }
                checkButtons();
            }, (err) => { 
                isLocationValid = false; 
                gpsMsg.innerHTML = `<span class="gps-no">âš ï¸ ìœ„ì¹˜ í™•ì¸ ë¶ˆê°€ - ìˆ˜ë™ ì²´í¬ ê°€ëŠ¥</span>`;
                checkButtons(); 
            }, { enableHighAccuracy: true });
        } else {
            isLocationValid = false;
            gpsMsg.innerHTML = `<span class="gps-no">âš ï¸ GPS ë¯¸ì§€ì› - ìˆ˜ë™ ì²´í¬ ê°€ëŠ¥</span>`;
            checkButtons();
        }
    }

    function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
        const R = 6371; 
        const dLat = deg2rad(lat2 - lat1); const dLon = deg2rad(lon2 - lon1);
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) + Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon/2) * Math.sin(dLon/2);
        return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)) * 1000;
    }
    function deg2rad(deg) { return deg * (Math.PI/180); }

    // ë°ì´í„° ë¡œë“œ
    function fetchMembers() {
        fetch(GAS_URL + "?action=getMembers").then(res => res.json()).then(data => {
            membersData = data; 
            const depts = [...new Set(data.map(item => item[0]))];
            const deptSelect = document.getElementById('dept-select');
            depts.forEach(dept => {
                const opt = document.createElement('option');
                opt.value = dept; opt.text = dept;
                deptSelect.appendChild(opt);
            });
        });
    }

    function loadNames() {
        const dept = document.getElementById('dept-select').value;
        const nameSelect = document.getElementById('name-select');
        nameSelect.innerHTML = '<option value="">ì´ë¦„ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        nameSelect.disabled = false;
        membersData.filter(r => r[0] === dept).forEach(r => {
            const opt = document.createElement('option');
            opt.value = r[1]; opt.text = r[1];
            nameSelect.appendChild(opt);
        });
        checkButtons();
    }

    // [ìˆ˜ì •ë¨] ë²„íŠ¼ í™œì„±í™” ì²´í¬ (ìœ„ì¹˜ ê²€ì¦ ì‹¤íŒ¨í•´ë„ ë²„íŠ¼ì€ í™œì„±í™”)
    function checkButtons() {
        const attendBtn = document.getElementById('attend-btn');
        
        // ì¿¨íƒ€ì„ ì²´í¬ (ê´€ë¦¬ìëŠ” ë¬´ì‹œ)
        const lastSubmitTime = localStorage.getItem("last_submit_time");
        if (lastSubmitTime && !isAdminMode) {
            const now = new Date().getTime();
            const diff = now - parseInt(lastSubmitTime);
            const limit = 10 * 60 * 1000; 
            if (diff < limit) {
                const minLeft = Math.ceil((limit - diff) / 60000);
                attendBtn.disabled = true;
                attendBtn.innerText = `ì œì¶œ ë¶ˆê°€ (${minLeft}ë¶„ ë‚¨ìŒ)`;
                return; 
            }
        }
        if (attendBtn.innerText.includes("ì œì¶œ ë¶ˆê°€")) attendBtn.innerText = "ì¶œì„ì²´í¬ í•˜ê¸°";

        const nameSelected = document.getElementById('name-select').value !== "";
        // ìœ„ì¹˜(isLocationValid) ì¡°ê±´ ì‚­ì œ -> ì‹œê°„ê³¼ ì´ë¦„ë§Œ ìˆìœ¼ë©´ ë²„íŠ¼ í™œì„±í™”
        attendBtn.disabled = !(nameSelected && isTimeValid); 
    }

    // [ìˆ˜ì •ë¨] ì¶œì„ ì²˜ë¦¬ (ìœ„ì¹˜ ì‹¤íŒ¨ ì‹œ íŒì—… ë„ìš°ê¸°)
    function handleAttendance(type) {
        const dept = document.getElementById('dept-select').value;
        const name = document.getElementById('name-select').value;
        let note = "ì •ìƒì¶œì„";

        if (!dept || !name) { alert("ë¶€ì„œì™€ ì´ë¦„ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."); return; }

        if (type === 'attend') {
            if(!isTimeValid) { alert("ì§€ê¸ˆì€ ì¶œì„ ì²´í¬ ì‹œê°„ì´ ì•„ë‹™ë‹ˆë‹¤."); return; }
            
            // â˜… ìœ„ì¹˜ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šìœ¼ë©´ ìˆ˜ë™ í™•ì¸ íŒì—… ë„ìš°ê¸°
            if (!isLocationValid && !isAdminMode) {
                if (!confirm("âš ï¸ í˜„ì¬ ìœ„ì¹˜ê°€ í™•ì¸ë˜ì§€ ì•Šê±°ë‚˜ êµíšŒì™€ ê±°ë¦¬ê°€ ë©‰ë‹ˆë‹¤.\n\nêµíšŒì— ë„ì°©í•˜ì…¨ìŠµë‹ˆê¹Œ?\n(ì˜ˆë¥¼ ëˆ„ë¥´ë©´ ì¶œì„ ì²˜ë¦¬ë©ë‹ˆë‹¤)")) {
                    return; // ì·¨ì†Œ ëˆ„ë¥´ë©´ ì—¬ê¸°ì„œ ì¤‘ë‹¨
                }
            }

            // ìœ„ì¹˜ ì¸ì¦ í†µê³¼ or ìˆ˜ë™ í™•ì¸ í†µê³¼ í›„ ì´ë¦„ ì¬í™•ì¸
            if (!confirm(`[${dept} - ${name}] ë‹˜ì´ ë§ìŠµë‹ˆê¹Œ?\n\n'í™•ì¸'ì„ ëˆ„ë¥´ë©´ ì¶œì„ë©ë‹ˆë‹¤.`)) return;

        } else if (type === 'excuse') {
            const reason = document.getElementById('excuse-select-popup').value;
            if (reason === "") { alert("ì‚¬ìœ ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
            if (!confirm(`[${reason}] ì‚¬ìœ ë¡œ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            note = reason;
        }

        // ì „ì†¡ ì¤‘ UI ì²˜ë¦¬
        const btn = document.getElementById('attend-btn');
        btn.disabled = true; 
        btn.innerText = "ì „ì†¡ ì¤‘...";

        fetch(GAS_URL, { 
            method: "POST", mode: "no-cors", 
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ dept, name, note }) 
        })
        .then(() => { 
            if(type === 'attend') fireConfetti(); 
            setTimeout(() => {
                alert(`ğŸ‰ [${name}]ë‹˜ ì¶œì„ ì²´í¬ ì™„ë£Œ!`);
                localStorage.setItem("last_submit_time", new Date().getTime());
                location.reload(); 
            }, 1000);
        })
        .catch(err => {
            alert("ì „ì†¡ ì‹¤íŒ¨. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");
            btn.disabled = false;
        });
    }

    // ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜
    function openExcuseModal() {
        const dept = document.getElementById('dept-select').value;
        const name = document.getElementById('name-select').value;
        if (!dept || !name) { alert("ì‚¬ìœ  ì œì¶œ ì „, ë¶€ì„œì™€ ì´ë¦„ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”."); return; }
        document.getElementById('excuseModal').style.display = "block";
    }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }
    window.onclick = function(e) { if(e.target.className === 'modal') e.target.style.display = "none"; }

    // í†µê³„ ë° ëª…ë‹¨ ë³´ê¸°
    function openStats() { 
        document.getElementById('statsModal').style.display = "block"; 
        drawStats(); 
    }

    function drawStats() {
        const ctx = document.getElementById('myChart').getContext('2d');
        const listBody = document.getElementById('today-log-list');
        const rankDiv = document.getElementById('rank-list');

        listBody.innerHTML = "<tr><td colspan='4'>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>";

        fetch(GAS_URL + "?action=getStats").then(res => res.json()).then(data => {
            // 1. ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            if (myChart) myChart.destroy(); 
            myChart = new Chart(ctx, {
                type: 'bar', 
                data: {
                    labels: data.deptStats.map(d => d.dept),
                    datasets: [{
                        label: 'ì¶œì„ ì ìˆ˜ìœ¨(%)',
                        data: data.deptStats.map(d => d.rate),
                        backgroundColor: '#36A2EB',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    scales: { y: { beginAtZero: true, max: 100 } },
                    plugins: { legend: { display: false } }
                }
            });

            // 2. ì˜¤ëŠ˜ ëª…ë‹¨ ë¦¬ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
            let html = "";
            if(data.todayList.length === 0) {
                html = "<tr><td colspan='4'>ì•„ì§ ì¶œì„í•œ ì‚¬ëŒì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>";
            } else {
                data.todayList.forEach(log => {
                    // â˜… ì§€ê° ì—¬ë¶€ì— ë”°ë¥¸ ë°°ì§€ ìƒ‰ìƒ ì²˜ë¦¬
                    let badgeClass = "bg-ok"; 
                    if (log.note === "ì§€ê°") {
                        badgeClass = "bg-warn"; // ì£¼í™©ìƒ‰
                    } else if (log.note !== "ì •ìƒì¶œì„" && log.note !== "ì •ìƒ") {
                        badgeClass = "bg-no"; // ë…¸ë€ìƒ‰
                    }

                    const noteText = log.note || "ì¶œì„";
                    html += `
                        <tr>
                            <td>${log.time}</td>
                            <td><strong>${log.name}</strong></td>
                            <td>${log.dept}</td>
                            <td><span class="badge ${badgeClass}">${noteText}</span></td>
                        </tr>
                    `;
                });
            }
            listBody.innerHTML = html;

            // 3. ëˆ„ì  ë­í‚¹ ê·¸ë¦¬ê¸° (í‰ê·  ì ìˆ˜ í‘œì‹œ)
            let rankHtml = '<ul style="padding-left: 20px; margin:0;">';
            data.rankList.forEach((p, index) => {
                let medal = index === 0 ? "ğŸ¥‡" : index === 1 ? "ğŸ¥ˆ" : "ğŸ¥‰";
                if(index > 2) medal = "ğŸ‘";
                rankHtml += `<li style="margin-bottom:5px;">${medal} <b>${p.name}</b> : ${p.score}ì </li>`;
            });
            rankHtml += '</ul>';
            if(data.rankList.length === 0) rankHtml = "<p>ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            rankDiv.innerHTML = rankHtml;
        });
    }

    function fireConfetti() {
        var duration = 1000;
        var end = Date.now() + duration;
        (function frame() {
            confetti({ particleCount: 3, angle: 60, spread: 55, origin: { x: 0 } });
            confetti({ particleCount: 3, angle: 120, spread: 55, origin: { x: 1 } });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }
</script>
</body>
</html>
